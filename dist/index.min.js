var t="function"==typeof queueMicrotask?queueMicrotask:t=>Promise.resolve().then(t);function e(){}function n(){n.init.call(this)}function i(t){return void 0===t._maxListeners?n.defaultMaxListeners:t._maxListeners}function s(t,n,s,r){var o,a,h,l;if("function"!=typeof s)throw new TypeError('"listener" argument must be a function');if((a=t._events)?(a.newListener&&(t.emit("newListener",n,s.listener?s.listener:s),a=t._events),h=a[n]):(a=t._events=new e,t._eventsCount=0),h){if("function"==typeof h?h=a[n]=r?[s,h]:[h,s]:r?h.unshift(s):h.push(s),!h.warned&&(o=i(t))&&o>0&&h.length>o){h.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+h.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=n,u.count=h.length,l=u,"function"==typeof console.warn?console.warn(l):console.log(l)}}else h=a[n]=s,++t._eventsCount;return t}function r(t,e,n){var i=!1;function s(){t.removeListener(e,s),i||(i=!0,n.apply(t,arguments))}return s.listener=n,s}function o(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function a(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}e.prototype=Object.create(null),n.EventEmitter=n,n.usingDomains=!1,n.prototype.domain=void 0,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.init=function(){this.domain=null,n.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new e,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},n.prototype.getMaxListeners=function(){return i(this)},n.prototype.emit=function(t){var e,n,i,s,r,o,h,l="error"===t;if(o=this._events)l=l&&null==o.error;else if(!l)return!1;if(h=this.domain,l){if(e=arguments[1],!h){if(e instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=h,e.domainThrown=!1,h.emit("error",e),!1}if(!(n=o[t]))return!1;var c="function"==typeof n;switch(i=arguments.length){case 1:!function(t,e,n){if(e)t.call(n);else for(var i=t.length,s=a(t,i),r=0;r<i;++r)s[r].call(n)}(n,c,this);break;case 2:!function(t,e,n,i){if(e)t.call(n,i);else for(var s=t.length,r=a(t,s),o=0;o<s;++o)r[o].call(n,i)}(n,c,this,arguments[1]);break;case 3:!function(t,e,n,i,s){if(e)t.call(n,i,s);else for(var r=t.length,o=a(t,r),h=0;h<r;++h)o[h].call(n,i,s)}(n,c,this,arguments[1],arguments[2]);break;case 4:!function(t,e,n,i,s,r){if(e)t.call(n,i,s,r);else for(var o=t.length,h=a(t,o),l=0;l<o;++l)h[l].call(n,i,s,r)}(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(s=new Array(i-1),r=1;r<i;r++)s[r-1]=arguments[r];!function(t,e,n,i){if(e)t.apply(n,i);else for(var s=t.length,r=a(t,s),o=0;o<s;++o)r[o].apply(n,i)}(n,c,this,s)}return!0},n.prototype.addListener=function(t,e){return s(this,t,e,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(t,e){return s(this,t,e,!0)},n.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,r(this,t,e)),this},n.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,r(this,t,e)),this},n.prototype.removeListener=function(t,n){var i,s,r,o,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(!(s=this._events))return this;if(!(i=s[t]))return this;if(i===n||i.listener&&i.listener===n)0==--this._eventsCount?this._events=new e:(delete s[t],s.removeListener&&this.emit("removeListener",t,i.listener||n));else if("function"!=typeof i){for(r=-1,o=i.length;o-- >0;)if(i[o]===n||i[o].listener&&i[o].listener===n){a=i[o].listener,r=o;break}if(r<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new e,this;delete s[t]}else!function(t,e){for(var n=e,i=n+1,s=t.length;i<s;n+=1,i+=1)t[n]=t[i];t.pop()}(i,r);s.removeListener&&this.emit("removeListener",t,a||n)}return this},n.prototype.off=function(t,e){return this.removeListener(t,e)},n.prototype.removeAllListeners=function(t){var n,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new e,this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=new e:delete i[t]),this;if(0===arguments.length){for(var s,r=Object.keys(i),o=0;o<r.length;++o)"removeListener"!==(s=r[o])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=new e,this._eventsCount=0,this}if("function"==typeof(n=i[t]))this.removeListener(t,n);else if(n)do{this.removeListener(t,n[n.length-1])}while(n[0]);return this},n.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(e):[]},n.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):o.call(t,e)},n.prototype.listenerCount=o,n.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};const h=function(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(Object.freeze({__proto__:null,default:n,EventEmitter:n})),l=t,u=_(new Error("Not readable")),c=_(new Error("Not writable")),f=_(new Error("Not deletable")),d=_(new Error("Not statable")),g=_(null),p=_(null),y=_(null);var b=class t extends h{constructor(e){super(),this._queued=[],this._pending=0,this._needsOpen=!0,this.opened=!1,this.suspended=!1,this.closed=!1,this.unlinked=!1,this.writing=!1,e&&(e.open&&(this._open=e.open),e.read&&(this._read=e.read),e.write&&(this._write=e.write),e.del&&(this._del=e.del),e.truncate&&(this._truncate=e.truncate),e.stat&&(this._stat=e.stat),e.suspend&&(this._suspend=e.suspend),e.close&&(this._close=e.close),e.unlink&&(this._unlink=e.unlink)),this.readable=this._read!==t.prototype._read,this.writable=this._write!==t.prototype._write,this.deletable=this._del!==t.prototype._del,this.truncatable=this._truncate!==t.prototype._truncate||this.deletable,this.statable=this._stat!==t.prototype._stat}read(t,e,n){this.run(new w(this,0,t,e,null,n),!1)}_read(t){return u(t)}write(t,e,n){n||(n=S),this.run(new w(this,1,t,e.length,e,n),!0)}_write(t){return c(t)}del(t,e,n){n||(n=S),this.run(new w(this,2,t,e,null,n),!0)}_del(t){return f(t)}truncate(t,e){e||(e=S),this.run(new w(this,3,t,0,null,e),!0)}_truncate(t){t.size=1/0,this._del(t)}stat(t){this.run(new w(this,4,0,0,null,t),!1)}_stat(t){return d(t)}open(t){if(t||(t=S),this.opened&&!this._needsOpen)return L(t);this._needsOpen=!1,m(this,new w(this,5,0,0,null,t))}_open(t){return g(t)}suspend(t){if(t||(t=S),this.closed||this.suspended)return L(t);this._needsOpen=!0,m(this,new w(this,6,0,0,null,t))}_suspend(t){this._close(t)}close(t){if(t||(t=S),this.closed)return L(t);m(this,new w(this,7,0,0,null,t))}_close(t){return p(t)}unlink(t){t||(t=S),this.closed||this.close(S),m(this,new w(this,8,0,0,null,t))}_unlink(t){return y(t)}run(t,e){e&&!this.writing&&(this.writing=!0,this._needsOpen=!0),this._needsOpen&&this.open(S),this._queued.length?this._queued.push(t):t._run()}};let w=class{constructor(t,e,n,i,s,r){this.type=e,this.offset=n,this.size=i,this.data=s,this.storage=t,this._sync=!1,this._callback=r,this._openError=null}_maybeOpenError(t){if(5!==this.type)return;const e=this.storage._queued;for(let n=1;n<e.length;n++){const i=e[n];if(5===i.type)break;i._openError=t}}_unqueue(t){const e=this.storage,n=e._queued;if(t)this._maybeOpenError(t);else if(this.type>4)switch(this.type){case 5:e.suspended&&(e.suspended=!1,e.emit("unsuspend")),e.opened||(e.opened=!0,e.emit("open"));break;case 6:e.suspended||(e.suspended=!0,e.emit("suspend"));break;case 7:e.closed||(e.closed=!0,e.emit("close"));break;case 8:e.unlinked||(e.unlinked=!0,e.emit("unlink"))}n.length&&n[0]===this&&n.shift(),--e._pending||function(t){const e=t._queued;for(;e.length>0;){const n=e[0].type>4;if(n&&t._pending||e[0]._run(),n)return;e.shift()}}(e)}callback(t,e){if(this._sync)return v(this,t,e);this._unqueue(t),this._callback(t,e)}_openAndNotClosed(){const t=this.storage;return!(!t.opened||t.closed||t.suspended)||(!t.opened||t.suspended?v(this,this._openError||new Error("Not opened")):t.closed&&v(this,new Error("Closed")),!1)}_open(){const t=this.storage;return t.opened&&!t.suspended?v(this,null):t.closed?v(this,new Error("Closed")):void t._open(this)}_run(){const t=this.storage;switch(t._pending++,this._sync=!0,this.type){case 0:this._openAndNotClosed()&&t._read(this);break;case 1:this._openAndNotClosed()&&t._write(this);break;case 2:this._openAndNotClosed()&&t._del(this);break;case 3:this._openAndNotClosed()&&t._truncate(this);break;case 4:this._openAndNotClosed()&&t._stat(this);break;case 5:this._open();break;case 6:t.closed||!t.opened||t.suspended?v(this,null):t._suspend(this);break;case 7:t.closed||!t.opened||t.suspended?v(this,null):t._close(this);break;case 8:t.unlinked?v(this,null):t._unlink(this)}this._sync=!1}};function m(t,e){t._queued.push(e),t._pending||e._run()}function _(t){return function(e){v(e,t)}}function v(t,e,n){l((()=>t.callback(e,n)))}function L(t){l((()=>t(null)))}function S(){}var k={exports:{}};function E(t){return t.length}var x={byteLength:E,toString:function(t){const e=t.byteLength;let n="";for(let i=0;i<e;i++)n+=String.fromCharCode(t[i]);return n},write:function(t,e,n=0,i=E(e)){const s=Math.min(i,t.byteLength-n);for(let i=0;i<s;i++)t[n+i]=e.charCodeAt(i);return s}};const z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",O=new Uint8Array(256);for(let t=0;t<64;t++)O[z.charCodeAt(t)]=t;function A(t){let e=t.length;return 61===t.charCodeAt(e-1)&&e--,e>1&&61===t.charCodeAt(e-1)&&e--,3*e>>>2}O[45]=62,O[95]=63;var D={byteLength:A,toString:function(t){const e=t.byteLength;let n="";for(let i=0;i<e;i+=3)n+=z[t[i]>>2]+z[(3&t[i])<<4|t[i+1]>>4]+z[(15&t[i+1])<<2|t[i+2]>>6]+z[63&t[i+2]];return e%3==2?n=n.substring(0,n.length-1)+"=":e%3==1&&(n=n.substring(0,n.length-2)+"=="),n},write:function(t,e,n=0,i=A(e)){const s=Math.min(i,t.byteLength-n);for(let n=0,i=0;i<s;n+=4){const s=O[e.charCodeAt(n)],r=O[e.charCodeAt(n+1)],o=O[e.charCodeAt(n+2)],a=O[e.charCodeAt(n+3)];t[i++]=s<<2|r>>4,t[i++]=(15&r)<<4|o>>2,t[i++]=(3&o)<<6|63&a}return s}};function C(t){return t.length>>>1}var T={byteLength:C,toString:function(t){const e=t.byteLength;t=new DataView(t.buffer,t.byteOffset,e);let n="",i=0;for(let s=e-e%4;i<s;i+=4)n+=t.getUint32(i).toString(16).padStart(8,"0");for(;i<e;i++)n+=t.getUint8(i).toString(16).padStart(2,"0");return n},write:function(t,e,n=0,i=C(e)){const s=Math.min(i,t.byteLength-n);for(let i=0;i<s;i++){const s=M(e.charCodeAt(2*i)),r=M(e.charCodeAt(2*i+1));if(void 0===s||void 0===r)return t.subarray(0,i);t[n+i]=s<<4|r}return s}};function M(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:void 0}function F(t){let e=0;for(let n=0,i=t.length;n<i;n++){const s=t.charCodeAt(n);if(s>=55296&&s<=56319&&n+1<i){const i=t.charCodeAt(n+1);if(i>=56320&&i<=57343){e+=4,n++;continue}}e+=s<=127?1:s<=2047?2:3}return e}let U,I;if("undefined"!=typeof TextDecoder){const t=new TextDecoder;U=function(e){return t.decode(e)}}else U=function(t){const e=t.byteLength;let n="",i=0;for(;i<e;){let s=t[i];if(s<=127){n+=String.fromCharCode(s),i++;continue}let r=0,o=0;if(s<=223?(r=1,o=31&s):s<=239?(r=2,o=15&s):s<=244&&(r=3,o=7&s),e-i-r>0){let e=0;for(;e<r;)s=t[i+e+1],o=o<<6|63&s,e+=1}else o=65533,r=e-i;n+=String.fromCodePoint(o),i+=r+1}return n};if("undefined"!=typeof TextEncoder){const t=new TextEncoder;I=function(e,n,i=0,s=F(n)){const r=Math.min(s,e.byteLength-i);return t.encodeInto(n,e.subarray(i,i+r)),r}}else I=function(t,e,n=0,i=F(e)){const s=Math.min(i,t.byteLength-n);t=t.subarray(n,n+s);let r=0,o=0;for(;r<e.length;){const n=e.codePointAt(r);if(n<=127){t[o++]=n,r++;continue}let i=0,s=0;for(n<=2047?(i=6,s=192):n<=65535?(i=12,s=224):n<=2097151&&(i=18,s=240),t[o++]=s|n>>i,i-=6;i>=0;)t[o++]=128|n>>i&63,i-=6;r+=n>=65536?2:1}return s};var N={byteLength:F,toString:U,write:I};function P(t){return 2*t.length}var B={byteLength:P,toString:function(t){const e=t.byteLength;let n="";for(let i=0;i<e-1;i+=2)n+=String.fromCharCode(t[i]+256*t[i+1]);return n},write:function(t,e,n=0,i=P(e)){const s=Math.min(i,t.byteLength-n);let r=s;for(let i=0;i<e.length&&!((r-=2)<0);++i){const s=e.charCodeAt(i),r=s>>8,o=s%256;t[n+2*i]=o,t[n+2*i+1]=r}return s}};!function(t,e){const n=x,i=D,s=T,r=N,o=B,a=255===new Uint8Array(Uint16Array.of(255).buffer)[0];function h(t){switch(t){case"ascii":return n;case"base64":return i;case"hex":return s;case"utf8":case"utf-8":case void 0:case null:return r;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o;default:throw new Error(`Unknown encoding: ${t}`)}}function l(t){return t instanceof Uint8Array}function u(t,e,n){return"string"==typeof t?function(t,e){const n=h(e),i=new Uint8Array(n.byteLength(t));return n.write(i,t,0,i.byteLength),i}(t,e):Array.isArray(t)?function(t){const e=new Uint8Array(t.length);return e.set(t),e}(t):ArrayBuffer.isView(t)?function(t){const e=new Uint8Array(t.byteLength);return e.set(t),e}(t):function(t,e,n){return new Uint8Array(t,e,n)}(t,e,n)}function c(t,e,n,i,s){if(0===t.byteLength)return-1;if("string"==typeof n?(i=n,n=0):void 0===n?n=s?0:t.length-1:n<0&&(n+=t.byteLength),n>=t.byteLength){if(s)return-1;n=t.byteLength-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof e)e=u(e,i);else if("number"==typeof e)return e&=255,s?t.indexOf(e,n):t.lastIndexOf(e,n);if(0===e.byteLength)return-1;if(s){let i=-1;for(let s=n;s<t.byteLength;s++)if(t[s]===e[-1===i?0:s-i]){if(-1===i&&(i=s),s-i+1===e.byteLength)return i}else-1!==i&&(s-=s-i),i=-1}else{n+e.byteLength>t.byteLength&&(n=t.byteLength-e.byteLength);for(let i=n;i>=0;i--){let n=!0;for(let s=0;s<e.byteLength;s++)if(t[i+s]!==e[s]){n=!1;break}if(n)return i}}return-1}function f(t,e,n,i){return c(t,e,n,i,!0)}function d(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}t.exports=e={isBuffer:l,isEncoding:function(t){try{return h(t),!0}catch{return!1}},alloc:function(t,n,i){const s=new Uint8Array(t);return void 0!==n&&e.fill(s,n,0,s.byteLength,i),s},allocUnsafe:function(t){return new Uint8Array(t)},allocUnsafeSlow:function(t){return new Uint8Array(t)},byteLength:function(t,e){return h(e).byteLength(t)},compare:function(t,e){if(t===e)return 0;const n=Math.min(t.byteLength,e.byteLength);t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let i=0;for(let s=n-n%4;i<s&&t.getUint32(i,a)===e.getUint32(i,a);i+=4);for(;i<n;i++){const n=t.getUint8(i),s=e.getUint8(i);if(n<s)return-1;if(n>s)return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0},concat:function(t,e){void 0===e&&(e=t.reduce(((t,e)=>t+e.byteLength),0));const n=new Uint8Array(e);let i=0;for(const e of t){if(i+e.byteLength>n.byteLength){const t=e.subarray(0,n.byteLength-i);return n.set(t,i),n}n.set(e,i),i+=e.byteLength}return n},copy:function(t,e,n=0,i=0,s=t.byteLength){if(s>0&&s<i)return 0;if(s===i)return 0;if(0===t.byteLength||0===e.byteLength)return 0;if(n<0)throw new RangeError("targetStart is out of range");if(i<0||i>=t.byteLength)throw new RangeError("sourceStart is out of range");if(s<0)throw new RangeError("sourceEnd is out of range");n>=e.byteLength&&(n=e.byteLength),s>t.byteLength&&(s=t.byteLength),e.byteLength-n<s-i&&(s=e.length-n+i);const r=s-i;return t===e?e.copyWithin(n,i,s):e.set(t.subarray(i,s),n),r},equals:function(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;const n=t.byteLength;t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let i=0;for(let s=n-n%4;i<s;i+=4)if(t.getUint32(i,a)!==e.getUint32(i,a))return!1;for(;i<n;i++)if(t.getUint8(i)!==e.getUint8(i))return!1;return!0},fill:function(t,e,n,i,s){if("string"==typeof e?"string"==typeof n?(s=n,n=0,i=t.byteLength):"string"==typeof i&&(s=i,i=t.byteLength):"number"==typeof e?e&=255:"boolean"==typeof e&&(e=+e),n<0||t.byteLength<n||t.byteLength<i)throw new RangeError("Out of range index");if(void 0===n&&(n=0),void 0===i&&(i=t.byteLength),i<=n)return t;if(e||(e=0),"number"==typeof e)for(let s=n;s<i;++s)t[s]=e;else{const r=(e=l(e)?e:u(e,s)).byteLength;for(let s=0;s<i-n;++s)t[s+n]=e[s%r]}return t},from:u,includes:function(t,e,n,i){return-1!==f(t,e,n,i)},indexOf:f,lastIndexOf:function(t,e,n,i){return c(t,e,n,i,!1)},swap16:function(t){const e=t.byteLength;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let n=0;n<e;n+=2)d(t,n,n+1);return t},swap32:function(t){const e=t.byteLength;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let n=0;n<e;n+=4)d(t,n,n+3),d(t,n+1,n+2);return t},swap64:function(t){const e=t.byteLength;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let n=0;n<e;n+=8)d(t,n,n+7),d(t,n+1,n+6),d(t,n+2,n+5),d(t,n+3,n+4);return t},toBuffer:function(t){return t},toString:function(t,e,n=0,i=t.byteLength){const s=t.byteLength;return n>=s||i<=n?"":(n<0&&(n=0),i>s&&(i=s),(0!==n||i<s)&&(t=t.subarray(n,i)),h(e).toString(t))},write:function(t,e,n,i,s){return void 0===n?s="utf8":void 0===i&&"string"==typeof n?(s=n,n=void 0):void 0===s&&"string"==typeof i&&(s=i,i=void 0),h(s).write(t,e,n,i)},writeDoubleLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e,!0),n+8},writeFloatLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e,!0),n+4},writeUInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(n,e,!0),n+4},writeInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setInt32(n,e,!0),n+4},readDoubleLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat64(e,!0)},readFloatLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat32(e,!0)},readUInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getUint32(e,!0)},readInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(e,!0)},writeDoubleBE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e,!1),n+8},writeFloatBE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e,!1),n+4},writeUInt32BE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(n,e,!1),n+4},writeInt32BE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setInt32(n,e,!1),n+4},readDoubleBE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat64(e,!1)},readFloatBE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat32(e,!1)},readUInt32BE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getUint32(e,!1)},readInt32BE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(e,!1)}}}(k,k.exports);var R=k.exports,q="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function W(){throw new Error("setTimeout has not been defined")}function V(){throw new Error("clearTimeout has not been defined")}var j=W,G=V;function H(t){if(j===setTimeout)return setTimeout(t,0);if((j===W||!j)&&setTimeout)return j=setTimeout,setTimeout(t,0);try{return j(t,0)}catch(e){try{return j.call(null,t,0)}catch(e){return j.call(this,t,0)}}}"function"==typeof q.setTimeout&&(j=setTimeout),"function"==typeof q.clearTimeout&&(G=clearTimeout);var $,Q=[],K=!1,X=-1;function Y(){K&&$&&(K=!1,$.length?Q=$.concat(Q):X=-1,Q.length&&J())}function J(){if(!K){var t=H(Y);K=!0;for(var e=Q.length;e;){for($=Q,Q=[];++X<e;)$&&$[X].run();X=-1,e=Q.length}$=null,K=!1,function(t){if(G===clearTimeout)return clearTimeout(t);if((G===V||!G)&&clearTimeout)return G=clearTimeout,clearTimeout(t);try{return G(t)}catch(e){try{return G.call(null,t)}catch(e){return G.call(this,t)}}}(t)}}function Z(t,e){this.fun=t,this.array=e}function tt(){}Z.prototype.run=function(){this.fun.apply(null,this.array)};var et=tt,nt=tt,it=tt,st=tt,rt=tt,ot=tt,at=tt,ht=q.performance||{},lt=ht.now||ht.mozNow||ht.msNow||ht.oNow||ht.webkitNow||function(){return(new Date).getTime()},ut=new Date,ct={nextTick:function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];Q.push(new Z(t,e)),1!==Q.length||K||H(J)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:et,addListener:nt,once:it,off:st,removeListener:rt,removeAllListeners:ot,emit:at,binding:function(t){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(t){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(t){var e=.001*lt.call(ht),n=Math.floor(e),i=Math.floor(e%1*1e9);return t&&(n-=t[0],(i-=t[1])<0&&(n--,i+=1e9)),[n,i]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-ut)/1e3}};const ft="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,dt=new Set,gt=ct||{},pt=(t,e,n,i)=>{"function"==typeof gt.emitWarning?gt.emitWarning(t,e,n,i):console.error(`[${n}] ${e}: ${t}`)};let yt=globalThis.AbortController,bt=globalThis.AbortSignal;if(void 0===yt){bt=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(t,e){this._onabort.push(e)}},yt=class{constructor(){e()}signal=new bt;abort(t){if(!this.signal.aborted){this.signal.reason=t,this.signal.aborted=!0;for(const e of this.signal._onabort)e(t);this.signal.onabort?.(t)}}};let t="1"!==gt.env?.LRU_CACHE_IGNORE_AC_WARNING;const e=()=>{t&&(t=!1,pt("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const wt=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),mt=t=>wt(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?_t:null:null;let _t=class extends Array{constructor(t){super(t),this.fill(0)}},vt=class t{heap;length;static#t=!1;static create(e){const n=mt(e);if(!n)return[];t.#t=!0;const i=new t(e,n);return t.#t=!1,i}constructor(e,n){if(!t.#t)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new n(e),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}},Lt=class t{#e;#n;#i;#s;#r;#o;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#a;#h;#l;#u;#c;#f;#d;#g;#p;#y;#b;#w;#m;#_;#v;#L;#S;static unsafeExposeInternals(t){return{starts:t.#m,ttls:t.#_,sizes:t.#w,keyMap:t.#l,keyList:t.#u,valList:t.#c,next:t.#f,prev:t.#d,get head(){return t.#g},get tail(){return t.#p},free:t.#y,isBackgroundFetch:e=>t.#k(e),backgroundFetch:(e,n,i,s)=>t.#E(e,n,i,s),moveToTail:e=>t.#x(e),indexes:e=>t.#z(e),rindexes:e=>t.#O(e),isStale:e=>t.#A(e)}}get max(){return this.#e}get maxSize(){return this.#n}get calculatedSize(){return this.#h}get size(){return this.#a}get fetchMethod(){return this.#r}get memoMethod(){return this.#o}get dispose(){return this.#i}get disposeAfter(){return this.#s}constructor(e){const{max:n=0,ttl:i,ttlResolution:s=1,ttlAutopurge:r,updateAgeOnGet:o,updateAgeOnHas:a,allowStale:h,dispose:l,disposeAfter:u,noDisposeOnSet:c,noUpdateTTL:f,maxSize:d=0,maxEntrySize:g=0,sizeCalculation:p,fetchMethod:y,memoMethod:b,noDeleteOnFetchRejection:w,noDeleteOnStaleGet:m,allowStaleOnFetchRejection:_,allowStaleOnFetchAbort:v,ignoreFetchAbort:L}=e;if(0!==n&&!wt(n))throw new TypeError("max option must be a nonnegative integer");const S=n?mt(n):Array;if(!S)throw new Error("invalid max value: "+n);if(this.#e=n,this.#n=d,this.maxEntrySize=g||this.#n,this.sizeCalculation=p,this.sizeCalculation){if(!this.#n&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(void 0!==b&&"function"!=typeof b)throw new TypeError("memoMethod must be a function if defined");if(this.#o=b,void 0!==y&&"function"!=typeof y)throw new TypeError("fetchMethod must be a function if specified");if(this.#r=y,this.#L=!!y,this.#l=new Map,this.#u=new Array(n).fill(void 0),this.#c=new Array(n).fill(void 0),this.#f=new S(n),this.#d=new S(n),this.#g=0,this.#p=0,this.#y=vt.create(n),this.#a=0,this.#h=0,"function"==typeof l&&(this.#i=l),"function"==typeof u?(this.#s=u,this.#b=[]):(this.#s=void 0,this.#b=void 0),this.#v=!!this.#i,this.#S=!!this.#s,this.noDisposeOnSet=!!c,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!w,this.allowStaleOnFetchRejection=!!_,this.allowStaleOnFetchAbort=!!v,this.ignoreFetchAbort=!!L,0!==this.maxEntrySize){if(0!==this.#n&&!wt(this.#n))throw new TypeError("maxSize must be a positive integer if specified");if(!wt(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#D()}if(this.allowStale=!!h,this.noDeleteOnStaleGet=!!m,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!a,this.ttlResolution=wt(s)||0===s?s:1,this.ttlAutopurge=!!r,this.ttl=i||0,this.ttl){if(!wt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#C()}if(0===this.#e&&0===this.ttl&&0===this.#n)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#e&&!this.#n){const e="LRU_CACHE_UNBOUNDED";(t=>!dt.has(t))(e)&&(dt.add(e),pt("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,t))}}getRemainingTTL(t){return this.#l.has(t)?1/0:0}#C(){const t=new _t(this.#e),e=new _t(this.#e);this.#_=t,this.#m=e,this.#T=(n,i,s=ft.now())=>{if(e[n]=0!==i?s:0,t[n]=i,0!==i&&this.ttlAutopurge){const t=setTimeout((()=>{this.#A(n)&&this.#M(this.#u[n],"expire")}),i+1);t.unref&&t.unref()}},this.#F=n=>{e[n]=0!==t[n]?ft.now():0},this.#U=(s,r)=>{if(t[r]){const o=t[r],a=e[r];if(!o||!a)return;s.ttl=o,s.start=a,s.now=n||i();const h=s.now-a;s.remainingTTL=o-h}};let n=0;const i=()=>{const t=ft.now();if(this.ttlResolution>0){n=t;const e=setTimeout((()=>n=0),this.ttlResolution);e.unref&&e.unref()}return t};this.getRemainingTTL=s=>{const r=this.#l.get(s);if(void 0===r)return 0;const o=t[r],a=e[r];return o&&a?o-((n||i())-a):1/0},this.#A=s=>{const r=e[s],o=t[s];return!!o&&!!r&&(n||i())-r>o}}#F=()=>{};#U=()=>{};#T=()=>{};#A=()=>!1;#D(){const t=new _t(this.#e);this.#h=0,this.#w=t,this.#I=e=>{this.#h-=t[e],t[e]=0},this.#N=(t,e,n,i)=>{if(this.#k(e))return 0;if(!wt(n)){if(!i)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof i)throw new TypeError("sizeCalculation must be a function");if(n=i(e,t),!wt(n))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return n},this.#P=(e,n,i)=>{if(t[e]=n,this.#n){const n=this.#n-t[e];for(;this.#h>n;)this.#B(!0)}this.#h+=t[e],i&&(i.entrySize=n,i.totalCalculatedSize=this.#h)}}#I=t=>{};#P=(t,e,n)=>{};#N=(t,e,n,i)=>{if(n||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#z({allowStale:t=this.allowStale}={}){if(this.#a)for(let e=this.#p;this.#R(e)&&(!t&&this.#A(e)||(yield e),e!==this.#g);)e=this.#d[e]}*#O({allowStale:t=this.allowStale}={}){if(this.#a)for(let e=this.#g;this.#R(e)&&(!t&&this.#A(e)||(yield e),e!==this.#p);)e=this.#f[e]}#R(t){return void 0!==t&&this.#l.get(this.#u[t])===t}*entries(){for(const t of this.#z())void 0===this.#c[t]||void 0===this.#u[t]||this.#k(this.#c[t])||(yield[this.#u[t],this.#c[t]])}*rentries(){for(const t of this.#O())void 0===this.#c[t]||void 0===this.#u[t]||this.#k(this.#c[t])||(yield[this.#u[t],this.#c[t]])}*keys(){for(const t of this.#z()){const e=this.#u[t];void 0===e||this.#k(this.#c[t])||(yield e)}}*rkeys(){for(const t of this.#O()){const e=this.#u[t];void 0===e||this.#k(this.#c[t])||(yield e)}}*values(){for(const t of this.#z())void 0===this.#c[t]||this.#k(this.#c[t])||(yield this.#c[t])}*rvalues(){for(const t of this.#O())void 0===this.#c[t]||this.#k(this.#c[t])||(yield this.#c[t])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(t,e={}){for(const n of this.#z()){const i=this.#c[n],s=this.#k(i)?i.__staleWhileFetching:i;if(void 0!==s&&t(s,this.#u[n],this))return this.get(this.#u[n],e)}}forEach(t,e=this){for(const n of this.#z()){const i=this.#c[n],s=this.#k(i)?i.__staleWhileFetching:i;void 0!==s&&t.call(e,s,this.#u[n],this)}}rforEach(t,e=this){for(const n of this.#O()){const i=this.#c[n],s=this.#k(i)?i.__staleWhileFetching:i;void 0!==s&&t.call(e,s,this.#u[n],this)}}purgeStale(){let t=!1;for(const e of this.#O({allowStale:!0}))this.#A(e)&&(this.#M(this.#u[e],"expire"),t=!0);return t}info(t){const e=this.#l.get(t);if(void 0===e)return;const n=this.#c[e],i=this.#k(n)?n.__staleWhileFetching:n;if(void 0===i)return;const s={value:i};if(this.#_&&this.#m){const t=this.#_[e],n=this.#m[e];if(t&&n){const e=t-(ft.now()-n);s.ttl=e,s.start=Date.now()}}return this.#w&&(s.size=this.#w[e]),s}dump(){const t=[];for(const e of this.#z({allowStale:!0})){const n=this.#u[e],i=this.#c[e],s=this.#k(i)?i.__staleWhileFetching:i;if(void 0===s||void 0===n)continue;const r={value:s};if(this.#_&&this.#m){r.ttl=this.#_[e];const t=ft.now()-this.#m[e];r.start=Math.floor(Date.now()-t)}this.#w&&(r.size=this.#w[e]),t.unshift([n,r])}return t}load(t){this.clear();for(const[e,n]of t){if(n.start){const t=Date.now()-n.start;n.start=ft.now()-t}this.set(e,n.value,n)}}set(t,e,n={}){if(void 0===e)return this.delete(t),this;const{ttl:i=this.ttl,start:s,noDisposeOnSet:r=this.noDisposeOnSet,sizeCalculation:o=this.sizeCalculation,status:a}=n;let{noUpdateTTL:h=this.noUpdateTTL}=n;const l=this.#N(t,e,n.size||0,o);if(this.maxEntrySize&&l>this.maxEntrySize)return a&&(a.set="miss",a.maxEntrySizeExceeded=!0),this.#M(t,"set"),this;let u=0===this.#a?void 0:this.#l.get(t);if(void 0===u)u=0===this.#a?this.#p:0!==this.#y.length?this.#y.pop():this.#a===this.#e?this.#B(!1):this.#a,this.#u[u]=t,this.#c[u]=e,this.#l.set(t,u),this.#f[this.#p]=u,this.#d[u]=this.#p,this.#p=u,this.#a++,this.#P(u,l,a),a&&(a.set="add"),h=!1;else{this.#x(u);const n=this.#c[u];if(e!==n){if(this.#L&&this.#k(n)){n.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:e}=n;void 0===e||r||(this.#v&&this.#i?.(e,t,"set"),this.#S&&this.#b?.push([e,t,"set"]))}else r||(this.#v&&this.#i?.(n,t,"set"),this.#S&&this.#b?.push([n,t,"set"]));if(this.#I(u),this.#P(u,l,a),this.#c[u]=e,a){a.set="replace";const t=n&&this.#k(n)?n.__staleWhileFetching:n;void 0!==t&&(a.oldValue=t)}}else a&&(a.set="update")}if(0===i||this.#_||this.#C(),this.#_&&(h||this.#T(u,i,s),a&&this.#U(a,u)),!r&&this.#S&&this.#b){const t=this.#b;let e;for(;e=t?.shift();)this.#s?.(...e)}return this}pop(){try{for(;this.#a;){const t=this.#c[this.#g];if(this.#B(!0),this.#k(t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(void 0!==t)return t}}finally{if(this.#S&&this.#b){const t=this.#b;let e;for(;e=t?.shift();)this.#s?.(...e)}}}#B(t){const e=this.#g,n=this.#u[e],i=this.#c[e];return this.#L&&this.#k(i)?i.__abortController.abort(new Error("evicted")):(this.#v||this.#S)&&(this.#v&&this.#i?.(i,n,"evict"),this.#S&&this.#b?.push([i,n,"evict"])),this.#I(e),t&&(this.#u[e]=void 0,this.#c[e]=void 0,this.#y.push(e)),1===this.#a?(this.#g=this.#p=0,this.#y.length=0):this.#g=this.#f[e],this.#l.delete(n),this.#a--,e}has(t,e={}){const{updateAgeOnHas:n=this.updateAgeOnHas,status:i}=e,s=this.#l.get(t);if(void 0!==s){const t=this.#c[s];if(this.#k(t)&&void 0===t.__staleWhileFetching)return!1;if(!this.#A(s))return n&&this.#F(s),i&&(i.has="hit",this.#U(i,s)),!0;i&&(i.has="stale",this.#U(i,s))}else i&&(i.has="miss");return!1}peek(t,e={}){const{allowStale:n=this.allowStale}=e,i=this.#l.get(t);if(void 0===i||!n&&this.#A(i))return;const s=this.#c[i];return this.#k(s)?s.__staleWhileFetching:s}#E(t,e,n,i){const s=void 0===e?void 0:this.#c[e];if(this.#k(s))return s;const r=new yt,{signal:o}=n;o?.addEventListener("abort",(()=>r.abort(o.reason)),{signal:r.signal});const a={signal:r.signal,options:n,context:i},h=(i,s=!1)=>{const{aborted:o}=r.signal,h=n.ignoreFetchAbort&&void 0!==i;if(n.status&&(o&&!s?(n.status.fetchAborted=!0,n.status.fetchError=r.signal.reason,h&&(n.status.fetchAbortIgnored=!0)):n.status.fetchResolved=!0),o&&!h&&!s)return l(r.signal.reason);const c=u;return this.#c[e]===u&&(void 0===i?c.__staleWhileFetching?this.#c[e]=c.__staleWhileFetching:this.#M(t,"fetch"):(n.status&&(n.status.fetchUpdated=!0),this.set(t,i,a.options))),i},l=i=>{const{aborted:s}=r.signal,o=s&&n.allowStaleOnFetchAbort,a=o||n.allowStaleOnFetchRejection,h=a||n.noDeleteOnFetchRejection,l=u;if(this.#c[e]===u&&(h&&void 0!==l.__staleWhileFetching?o||(this.#c[e]=l.__staleWhileFetching):this.#M(t,"fetch")),a)return n.status&&void 0!==l.__staleWhileFetching&&(n.status.returnedStale=!0),l.__staleWhileFetching;if(l.__returned===l)throw i};n.status&&(n.status.fetchDispatched=!0);const u=new Promise(((e,i)=>{const o=this.#r?.(t,s,a);o&&o instanceof Promise&&o.then((t=>e(void 0===t?void 0:t)),i),r.signal.addEventListener("abort",(()=>{n.ignoreFetchAbort&&!n.allowStaleOnFetchAbort||(e(void 0),n.allowStaleOnFetchAbort&&(e=t=>h(t,!0)))}))})).then(h,(t=>(n.status&&(n.status.fetchRejected=!0,n.status.fetchError=t),l(t)))),c=Object.assign(u,{__abortController:r,__staleWhileFetching:s,__returned:void 0});return void 0===e?(this.set(t,c,{...a.options,status:void 0}),e=this.#l.get(t)):this.#c[e]=c,c}#k(t){if(!this.#L)return!1;const e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof yt}async fetch(t,e={}){const{allowStale:n=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,ttl:r=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:a=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:l=this.noUpdateTTL,noDeleteOnFetchRejection:u=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:c=this.allowStaleOnFetchRejection,ignoreFetchAbort:f=this.ignoreFetchAbort,allowStaleOnFetchAbort:d=this.allowStaleOnFetchAbort,context:g,forceRefresh:p=!1,status:y,signal:b}=e;if(!this.#L)return y&&(y.fetch="get"),this.get(t,{allowStale:n,updateAgeOnGet:i,noDeleteOnStaleGet:s,status:y});const w={allowStale:n,updateAgeOnGet:i,noDeleteOnStaleGet:s,ttl:r,noDisposeOnSet:o,size:a,sizeCalculation:h,noUpdateTTL:l,noDeleteOnFetchRejection:u,allowStaleOnFetchRejection:c,allowStaleOnFetchAbort:d,ignoreFetchAbort:f,status:y,signal:b};let m=this.#l.get(t);if(void 0===m){y&&(y.fetch="miss");const e=this.#E(t,m,w,g);return e.__returned=e}{const e=this.#c[m];if(this.#k(e)){const t=n&&void 0!==e.__staleWhileFetching;return y&&(y.fetch="inflight",t&&(y.returnedStale=!0)),t?e.__staleWhileFetching:e.__returned=e}const s=this.#A(m);if(!p&&!s)return y&&(y.fetch="hit"),this.#x(m),i&&this.#F(m),y&&this.#U(y,m),e;const r=this.#E(t,m,w,g),o=void 0!==r.__staleWhileFetching&&n;return y&&(y.fetch=s?"stale":"refresh",o&&s&&(y.returnedStale=!0)),o?r.__staleWhileFetching:r.__returned=r}}async forceFetch(t,e={}){const n=await this.fetch(t,e);if(void 0===n)throw new Error("fetch() returned undefined");return n}memo(t,e={}){const n=this.#o;if(!n)throw new Error("no memoMethod provided to constructor");const{context:i,forceRefresh:s,...r}=e,o=this.get(t,r);if(!s&&void 0!==o)return o;const a=n(t,o,{options:r,context:i});return this.set(t,a,r),a}get(t,e={}){const{allowStale:n=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,status:r}=e,o=this.#l.get(t);if(void 0!==o){const e=this.#c[o],a=this.#k(e);return r&&this.#U(r,o),this.#A(o)?(r&&(r.get="stale"),a?(r&&n&&void 0!==e.__staleWhileFetching&&(r.returnedStale=!0),n?e.__staleWhileFetching:void 0):(s||this.#M(t,"expire"),r&&n&&(r.returnedStale=!0),n?e:void 0)):(r&&(r.get="hit"),a?e.__staleWhileFetching:(this.#x(o),i&&this.#F(o),e))}r&&(r.get="miss")}#q(t,e){this.#d[e]=t,this.#f[t]=e}#x(t){t!==this.#p&&(t===this.#g?this.#g=this.#f[t]:this.#q(this.#d[t],this.#f[t]),this.#q(this.#p,t),this.#p=t)}delete(t){return this.#M(t,"delete")}#M(t,e){let n=!1;if(0!==this.#a){const i=this.#l.get(t);if(void 0!==i)if(n=!0,1===this.#a)this.#W(e);else{this.#I(i);const n=this.#c[i];if(this.#k(n)?n.__abortController.abort(new Error("deleted")):(this.#v||this.#S)&&(this.#v&&this.#i?.(n,t,e),this.#S&&this.#b?.push([n,t,e])),this.#l.delete(t),this.#u[i]=void 0,this.#c[i]=void 0,i===this.#p)this.#p=this.#d[i];else if(i===this.#g)this.#g=this.#f[i];else{const t=this.#d[i];this.#f[t]=this.#f[i];const e=this.#f[i];this.#d[e]=this.#d[i]}this.#a--,this.#y.push(i)}}if(this.#S&&this.#b?.length){const t=this.#b;let e;for(;e=t?.shift();)this.#s?.(...e)}return n}clear(){return this.#W("delete")}#W(t){for(const e of this.#O({allowStale:!0})){const n=this.#c[e];if(this.#k(n))n.__abortController.abort(new Error("deleted"));else{const i=this.#u[e];this.#v&&this.#i?.(n,i,t),this.#S&&this.#b?.push([n,i,t])}}if(this.#l.clear(),this.#c.fill(void 0),this.#u.fill(void 0),this.#_&&this.#m&&(this.#_.fill(0),this.#m.fill(0)),this.#w&&this.#w.fill(0),this.#g=0,this.#p=0,this.#y.length=0,this.#h=0,this.#a=0,this.#S&&this.#b){const t=this.#b;let e;for(;e=t?.shift();)this.#s?.(...e)}}};var St,kt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};"function"!=typeof(St="undefined"==typeof self?kt:self).setImmediate&&(St.setImmediate=function(t){"function"==typeof Promise?Promise.resolve().then(t):setTimeout(t,0)});let Et=class t extends b{constructor(e,n={}){super(n),this._underlying=e,this.pageSize=n.pageSize||1048576,this.maxPages=n.maxPages||100,this._createIfMissing=void 0===n.createIfMissing||n.createIfMissing,this._strictSizeLimit=n.strictSizeEnforcement,this._flushOnClose=void 0===n.flushOnClose||n.flushOnClose,this._autoFlushOnEvict=void 0===n.autoFlushOnEvict||n.autoFlushOnEvict,this._opts=n,e instanceof t&&(e._strictSizeLimit=this._strictSizeLimit),this._pages=new Map,this._lru=new Lt({max:this.maxPages,dispose:this._onEvict.bind(this),noDisposeOnSet:!0}),this._pinnedPages=new Set,this._bitmask=null,this._size=0,this._fileExists=!1,this._accessTimes=new Map,this._modifiedPages=new Set,this.readable=!0,this.writable=!0,this.deletable=!0,this.truncatable=!0,this.statable=!0,this.destroyable=!0}get length(){return this._size}get size(){return this._size}_open(t){if(this.opened||this.opening)return t.callback(null);this.opening=!0;const e=e=>{this._fileExists=!0,"function"==typeof this._underlying.stat?this._underlying.stat(((e,n)=>{if(e)return this._size=0,this.opened=!0,this.opening=!1,t.callback(null,{size:0});this._size=Math.max(this._size,n.size),this.opened=!0,this.opening=!1,t.callback(null)})):(this.opened=!0,this.opening=!1,t.callback(null))};"function"==typeof this._underlying.open?this._underlying.open((n=>{if(n)return this.opening=!1,t.callback(n);e()})):e()}_read(t){this._ensureOpen((e=>{if(e)return t.callback(e);if(!this._fileExists)return t.callback(new Error("File does not exist"));if(void 0!==this._strictSizeLimit&&t.offset+t.size>this._strictSizeLimit)return t.callback(new Error("Read exceeds strict size enforcement"));const n=R.alloc(t.size,0);let i=0,s=t.offset;const r=()=>{if(i>=t.size)return t.callback(null,n);const e=Math.floor(s/this.pageSize),o=s%this.pageSize,a=Math.min(this.pageSize-o,t.size-i);this._getPage(e,((h,l)=>h&&h.message.includes("Read exceeds storage size")?(i+=a,s+=a,setImmediate(r)):h?t.callback(h):(n.set(l.data.subarray(o,o+a),i),this._touchPage(e),i+=a,s+=a,void setImmediate(r))))};r()}))}_write(t){console.log(`Write called on storage at offset ${t.offset}, size ${t.data.length}`),this._ensureOpen((e=>{if(e)return t.callback(e);if(void 0!==this._strictSizeLimit&&t.offset+t.data.length>this._strictSizeLimit)return t.callback(new Error("Write exceeds strict size enforcement"));let n=0,i=t.offset;const s=()=>{if(n>=t.data.length)return this._size=Math.max(this._size,t.offset+t.data.length),t.callback(null);const e=Math.floor(i/this.pageSize),r=i%this.pageSize,o=Math.min(this.pageSize-r,t.data.length-n);if(this._bitmask&&!this._isBitSet(i,o))return n+=o,i+=o,void setImmediate(s);this._getOrCreatePage(e,((a,h)=>{if(a)return t.callback(a);if(h.data.length<r+o){const t=R.alloc(r+o,0);R.copy(h.data,t),h.data=t}h.data.set(t.data.subarray(n,n+o),r),h.modified=!0,this._modifiedPages.add(e),this._pinnedPages.has(e)||this._touchPage(e),n+=o,i+=o,setImmediate(s)}))};s()}))}_del(t){this._ensureOpen((e=>{if(e)return t.callback(e);let n=0,i=t.offset;const s=t.size===1/0||t.offset+t.size>this._size?this._size:t.offset+t.size,r=()=>{if(n>=s-t.offset)return s===this._size&&(this._size=t.offset),t.callback(null);const e=Math.floor(i/this.pageSize),o=i%this.pageSize,a=Math.min(this.pageSize-o,s-i);this._getPage(e,((t,s)=>{s&&(R.fill(s.data,0,o,o+a),s.modified=!0,this._modifiedPages.add(e)),n+=a,i+=a,setImmediate(r)}))};r()}))}_truncate(t){this._ensureOpen((e=>{if(e)return t.callback(e);const n=t.offset;if(n>this._size){const e=n-this._size,i=R.alloc(e,0);this.write(this._size,i,(e=>{if(e)return t.callback(e);this._size=n,t.callback(null)}))}else{this._size=n;const e=Math.floor(n/this.pageSize),i=[...this._pages.keys()].filter((t=>t>e));for(const t of i)this._pages.delete(t),this._lru.delete(t),this._modifiedPages.delete(t),this._pinnedPages.delete(t);const s=this._pages.get(e);if(s){const t=n%this.pageSize;0===t?(this._pages.delete(e),this._lru.delete(e),this._modifiedPages.delete(e),this._pinnedPages.delete(e)):(s.data=s.data.subarray(0,t),s.modified=!0,this._modifiedPages.add(e))}this._supports("truncate")?this._underlying.truncate(n,(e=>{if(e)return t.callback(e);t.callback(null)})):t.callback(null)}}))}_stat(t){this._ensureOpen((e=>{if(e)return t.callback(e);t.callback(null,{size:this._size})}))}_close(t){const e=()=>{const e=()=>{this._supports("close")?this._underlying.close((e=>{if(e)return t.callback(e);this.closed=!0,t.callback(null)})):(this.closed=!0,t.callback(null))};this._flushOnClose?this.flush(0,this._size,(t=>{t&&console.error("Error during flush on close:",t),e()})):e()};this.opened?e():this._ensureOpen((n=>{if(n)return t.callback(n);e()}))}_unlink(t){this._ensureOpen((e=>{if(e)return t.callback(e);const n=()=>{this._supports("unlink")?this._underlying.unlink((e=>{if(e)return t.callback(e);this.unlinked=!0,t.callback(null)})):(this._pages.clear(),this._lru.clear(),this._modifiedPages.clear(),this._pinnedPages.clear(),this._size=0,this.unlinked=!0,t.callback(null))};this.opened?n():this._ensureOpen((e=>{if(e)return t.callback(e);n()}))}))}flush(t=0,e=this._size,n){"function"==typeof t&&(n=t,t=0),"function"==typeof e&&(n=e,e=this._size),this._ensureOpen((i=>{if(i)return n(i);e=Math.min(e,this._size),"function"==typeof this._underlying._ensureOpen?this._underlying._ensureOpen((i=>{if(i)return n(i);this._performFlush(t,e,n)})):this._performFlush(t,e,n)}))}_performFlush(t,e,n){const i=t+e,s=Math.floor(t/this.pageSize),r=Math.floor((i-1)/this.pageSize),o=[];for(let t=s;t<=r;t++)o.push(t);let a=0;const h=()=>{if(a>=o.length)return void(this._size<i&&this._supports("truncate")?this._underlying.truncate(this._size,(t=>{if(t)return n(t);n(null)})):n(null));const e=o[a++],l=e*this.pageSize,u=e===s?t%this.pageSize:0,c=e===r?(i-1)%this.pageSize+1:this.pageSize,f=c-u,d=this._pages.get(e),g=d?d.data.subarray(u,c):R.alloc(f,0);this._underlying.write(l+u,g,(t=>{if(t)return n(t);d&&d.modified&&(d.modified=!1,this._modifiedPages.delete(e)),setImmediate(h.bind(this))}))};h()}evict(t=1,e=!1,n=()=>{}){const i=this._lru.size,s=Math.ceil(i*t),r=[...this._lru.keys()].filter((t=>!this._pinnedPages.has(t))).reverse();let o=0;const a=()=>{if(o>=s||o>=r.length)return n(null);const t=r[o++];this._pages.get(t),e?this.flush(t*this.pageSize,this.pageSize,(e=>{e&&console.error(`Failed to flush page ${t} during eviction:`,e),this._evictPage(t),setImmediate(a)})):(this._evictPage(t),setImmediate(a))};a()}pin(t,e){const n=Math.floor(t/this.pageSize),i=Math.floor((t+e-1)/this.pageSize);for(let t=n;t<=i;t++)this._pinnedPages.add(t)}unpin(t,e){const n=Math.floor(t/this.pageSize),i=Math.floor((t+e-1)/this.pageSize);for(let t=n;t<=i;t++)this._pinnedPages.delete(t)}setBitmask(t){this._bitmask=t}clearBitmask(){this._bitmask=null}_isBitSet(t,e){if(!this._bitmask)return!0;for(let n=0;n<e;n++){const e=t+n,i=Math.floor(e/8),s=e%8;if(i>=this._bitmask.length)return!1;if(!(this._bitmask[i]>>s&1))return!1}return!0}_ensureOpen(t){if(this.opened)return t(null);this._underlying.open((e=>{if(e)return t(e);this._createIfMissing&&!this._fileExists?this._underlying.write(0,R.alloc(0),(e=>{if(e)return t(e);this._fileExists=!0,this._size=0,t(null)})):this._underlying.stat(((e,n)=>{e&&"ENOENT"===e.code?(this._fileExists=!1,this._size=0):e||(this._fileExists=!0,this._size=n.size||0),t(null)}))}))}_supports(t){return"function"==typeof this._underlying[t]}_getPage(t,e){let n=this._pages.get(t);if(n)return e(null,n);this._loadPage(t,e)}_getOrCreatePage(t,e){let n=this._pages.get(t);if(n)return e(null,n);this._loadOrCreatePage(t,e)}_loadPage(t,e){const n=t*this.pageSize,i={data:R.alloc(this.pageSize,0),modified:!1};if(this._fileExists&&this._supports("read")){const s=Math.min(this.pageSize,this._size-n);s>0?this._underlying.read(n,s,((n,r)=>{if(n)return e(n);i.data.set(r.subarray(0,s),0),this._pages.set(t,i),this._lru.set(t,!0),e(null,i)})):(this._pages.set(t,i),this._lru.set(t,!0),e(null,i))}else this._pages.set(t,i),this._lru.set(t,!0),e(null,i)}_loadOrCreatePage(t,e){this._loadPage(t,e)}_touchPage(t){this._accessTimes.set(t,Date.now()),this._lru.get(t)}_onEvict(t,e){const n=this._pages.get(t);if(n)return!this._pinnedPages.has(t)&&void(n.modified&&this._autoFlushOnEvict?this.flush(t*this.pageSize,this.pageSize,(e=>{e&&console.error(`Failed to flush page ${t} during eviction:`,e),this._evictPage(t)})):this._evictPage(t))}_evictPage(t){this._pinnedPages.has(t)||(this._pages.delete(t),this._lru.delete(t),this._modifiedPages.delete(t),this._accessTimes.delete(t))}};function xt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}globalThis.process={platform:"browser",cwd:()=>""};var zt={exports:{}};function Ot(t){return t.length}var At={byteLength:Ot,toString:function(t){const e=t.byteLength;let n="";for(let i=0;i<e;i++)n+=String.fromCharCode(t[i]);return n},write:function(t,e,n=0,i=Ot(e)){const s=Math.min(i,t.byteLength-n);for(let i=0;i<s;i++)t[n+i]=e.charCodeAt(i);return s}};const Dt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ct=new Uint8Array(256);for(let t=0;t<64;t++)Ct[Dt.charCodeAt(t)]=t;function Tt(t){let e=t.length;return 61===t.charCodeAt(e-1)&&e--,e>1&&61===t.charCodeAt(e-1)&&e--,3*e>>>2}Ct[45]=62,Ct[95]=63;var Mt={byteLength:Tt,toString:function(t){const e=t.byteLength;let n="";for(let i=0;i<e;i+=3)n+=Dt[t[i]>>2]+Dt[(3&t[i])<<4|t[i+1]>>4]+Dt[(15&t[i+1])<<2|t[i+2]>>6]+Dt[63&t[i+2]];return e%3==2?n=n.substring(0,n.length-1)+"=":e%3==1&&(n=n.substring(0,n.length-2)+"=="),n},write:function(t,e,n=0,i=Tt(e)){const s=Math.min(i,t.byteLength-n);for(let n=0,i=0;i<s;n+=4){const s=Ct[e.charCodeAt(n)],r=Ct[e.charCodeAt(n+1)],o=Ct[e.charCodeAt(n+2)],a=Ct[e.charCodeAt(n+3)];t[i++]=s<<2|r>>4,t[i++]=(15&r)<<4|o>>2,t[i++]=(3&o)<<6|63&a}return s}};function Ft(t){return t.length>>>1}var Ut={byteLength:Ft,toString:function(t){const e=t.byteLength;t=new DataView(t.buffer,t.byteOffset,e);let n="",i=0;for(let s=e-e%4;i<s;i+=4)n+=t.getUint32(i).toString(16).padStart(8,"0");for(;i<e;i++)n+=t.getUint8(i).toString(16).padStart(2,"0");return n},write:function(t,e,n=0,i=Ft(e)){const s=Math.min(i,t.byteLength-n);for(let i=0;i<s;i++){const s=It(e.charCodeAt(2*i)),r=It(e.charCodeAt(2*i+1));if(void 0===s||void 0===r)return t.subarray(0,i);t[n+i]=s<<4|r}return s}};function It(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:void 0}function Nt(t){let e=0;for(let n=0,i=t.length;n<i;n++){const s=t.charCodeAt(n);if(s>=55296&&s<=56319&&n+1<i){const i=t.charCodeAt(n+1);if(i>=56320&&i<=57343){e+=4,n++;continue}}e+=s<=127?1:s<=2047?2:3}return e}let Pt,Bt;if("undefined"!=typeof TextDecoder){const t=new TextDecoder;Pt=function(e){return t.decode(e)}}else Pt=function(t){const e=t.byteLength;let n="",i=0;for(;i<e;){let s=t[i];if(s<=127){n+=String.fromCharCode(s),i++;continue}let r=0,o=0;if(s<=223?(r=1,o=31&s):s<=239?(r=2,o=15&s):s<=244&&(r=3,o=7&s),e-i-r>0){let e=0;for(;e<r;)s=t[i+e+1],o=o<<6|63&s,e+=1}else o=65533,r=e-i;n+=String.fromCodePoint(o),i+=r+1}return n};if("undefined"!=typeof TextEncoder){const t=new TextEncoder;Bt=function(e,n,i=0,s=Nt(n)){const r=Math.min(s,e.byteLength-i);return t.encodeInto(n,e.subarray(i,i+r)),r}}else Bt=function(t,e,n=0,i=Nt(e)){const s=Math.min(i,t.byteLength-n);t=t.subarray(n,n+s);let r=0,o=0;for(;r<e.length;){const n=e.codePointAt(r);if(n<=127){t[o++]=n,r++;continue}let i=0,s=0;for(n<=2047?(i=6,s=192):n<=65535?(i=12,s=224):n<=2097151&&(i=18,s=240),t[o++]=s|n>>i,i-=6;i>=0;)t[o++]=128|n>>i&63,i-=6;r+=n>=65536?2:1}return s};var Rt={byteLength:Nt,toString:Pt,write:Bt};function qt(t){return 2*t.length}var Wt={byteLength:qt,toString:function(t){const e=t.byteLength;let n="";for(let i=0;i<e-1;i+=2)n+=String.fromCharCode(t[i]+256*t[i+1]);return n},write:function(t,e,n=0,i=qt(e)){const s=Math.min(i,t.byteLength-n);let r=s;for(let i=0;i<e.length&&!((r-=2)<0);++i){const s=e.charCodeAt(i),r=s>>8,o=s%256;t[n+2*i]=o,t[n+2*i+1]=r}return s}};!function(t,e){const n=At,i=Mt,s=Ut,r=Rt,o=Wt,a=255===new Uint8Array(Uint16Array.of(255).buffer)[0];function h(t){switch(t){case"ascii":return n;case"base64":return i;case"hex":return s;case"utf8":case"utf-8":case void 0:return r;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o;default:throw new Error(`Unknown encoding: ${t}`)}}function l(t){return t instanceof Uint8Array}function u(t,e,n){return"string"==typeof t?function(t,e){const n=h(e),i=new Uint8Array(n.byteLength(t));return n.write(i,t,0,i.byteLength),i}(t,e):Array.isArray(t)?function(t){const e=new Uint8Array(t.length);return e.set(t),e}(t):ArrayBuffer.isView(t)?function(t){const e=new Uint8Array(t.byteLength);return e.set(t),e}(t):function(t,e,n){return new Uint8Array(t,e,n)}(t,e,n)}function c(t,e,n,i,s){if(0===t.byteLength)return-1;if("string"==typeof n?(i=n,n=0):void 0===n?n=s?0:t.length-1:n<0&&(n+=t.byteLength),n>=t.byteLength){if(s)return-1;n=t.byteLength-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof e)e=u(e,i);else if("number"==typeof e)return e&=255,s?t.indexOf(e,n):t.lastIndexOf(e,n);if(0===e.byteLength)return-1;if(s){let i=-1;for(let s=n;s<t.byteLength;s++)if(t[s]===e[-1===i?0:s-i]){if(-1===i&&(i=s),s-i+1===e.byteLength)return i}else-1!==i&&(s-=s-i),i=-1}else{n+e.byteLength>t.byteLength&&(n=t.byteLength-e.byteLength);for(let i=n;i>=0;i--){let n=!0;for(let s=0;s<e.byteLength;s++)if(t[i+s]!==e[s]){n=!1;break}if(n)return i}}return-1}function f(t,e,n,i){return c(t,e,n,i,!0)}function d(t,e,n){const i=t[e];t[e]=t[n],t[n]=i}t.exports=e={isBuffer:l,isEncoding:function(t){try{return h(t),!0}catch{return!1}},alloc:function(t,n,i){const s=new Uint8Array(t);return void 0!==n&&e.fill(s,n,0,s.byteLength,i),s},allocUnsafe:function(t){return new Uint8Array(t)},allocUnsafeSlow:function(t){return new Uint8Array(t)},byteLength:function(t,e){return h(e).byteLength(t)},compare:function(t,e){if(t===e)return 0;const n=Math.min(t.byteLength,e.byteLength);t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let i=0;for(let s=n-n%4;i<s&&t.getUint32(i,a)===e.getUint32(i,a);i+=4);for(;i<n;i++){const n=t.getUint8(i),s=e.getUint8(i);if(n<s)return-1;if(n>s)return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0},concat:function(t,e){void 0===e&&(e=t.reduce(((t,e)=>t+e.byteLength),0));const n=new Uint8Array(e);let i=0;for(const e of t){if(i+e.byteLength>n.byteLength){const t=e.subarray(0,n.byteLength-i);return n.set(t,i),n}n.set(e,i),i+=e.byteLength}return n},copy:function(t,e,n=0,i=0,s=t.byteLength){if(s>0&&s<i)return 0;if(s===i)return 0;if(0===t.byteLength||0===e.byteLength)return 0;if(n<0)throw new RangeError("targetStart is out of range");if(i<0||i>=t.byteLength)throw new RangeError("sourceStart is out of range");if(s<0)throw new RangeError("sourceEnd is out of range");n>=e.byteLength&&(n=e.byteLength),s>t.byteLength&&(s=t.byteLength),e.byteLength-n<s-i&&(s=e.length-n+i);const r=s-i;return t===e?e.copyWithin(n,i,s):e.set(t.subarray(i,s),n),r},equals:function(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;const n=t.byteLength;t=new DataView(t.buffer,t.byteOffset,t.byteLength),e=new DataView(e.buffer,e.byteOffset,e.byteLength);let i=0;for(let s=n-n%4;i<s;i+=4)if(t.getUint32(i,a)!==e.getUint32(i,a))return!1;for(;i<n;i++)if(t.getUint8(i)!==e.getUint8(i))return!1;return!0},fill:function(t,e,n,i,s){if("string"==typeof e?"string"==typeof n?(s=n,n=0,i=t.byteLength):"string"==typeof i&&(s=i,i=t.byteLength):"number"==typeof e?e&=255:"boolean"==typeof e&&(e=+e),n<0||t.byteLength<n||t.byteLength<i)throw new RangeError("Out of range index");if(void 0===n&&(n=0),void 0===i&&(i=t.byteLength),i<=n)return t;if(e||(e=0),"number"==typeof e)for(let s=n;s<i;++s)t[s]=e;else{const r=(e=l(e)?e:u(e,s)).byteLength;for(let s=0;s<i-n;++s)t[s+n]=e[s%r]}return t},from:u,includes:function(t,e,n,i){return-1!==f(t,e,n,i)},indexOf:f,lastIndexOf:function(t,e,n,i){return c(t,e,n,i,!1)},swap16:function(t){const e=t.byteLength;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let n=0;n<e;n+=2)d(t,n,n+1);return t},swap32:function(t){const e=t.byteLength;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let n=0;n<e;n+=4)d(t,n,n+3),d(t,n+1,n+2);return t},swap64:function(t){const e=t.byteLength;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let n=0;n<e;n+=8)d(t,n,n+7),d(t,n+1,n+6),d(t,n+2,n+5),d(t,n+3,n+4);return t},toBuffer:function(t){return t},toString:function(t,e,n=0,i=t.byteLength){const s=t.byteLength;return n>=s||i<=n?"":(n<0&&(n=0),i>s&&(i=s),(0!==n||i<s)&&(t=t.subarray(n,i)),h(e).toString(t))},write:function(t,e,n,i,s){return void 0===n?s="utf8":void 0===i&&"string"==typeof n?(s=n,n=void 0):void 0===s&&"string"==typeof i&&(s=i,i=void 0),h(s).write(t,e,n,i)},writeDoubleLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e,!0),n+8},writeFloatLE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e,!0),n+4},writeUInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(n,e,!0),n+4},writeInt32LE:function(t,e,n){return void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setInt32(n,e,!0),n+4},readDoubleLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat64(e,!0)},readFloatLE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getFloat32(e,!0)},readUInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getUint32(e,!0)},readInt32LE:function(t,e){return void 0===e&&(e=0),new DataView(t.buffer,t.byteOffset,t.byteLength).getInt32(e,!0)}}}(zt,zt.exports);var Vt=xt(zt.exports);const jt=(t,e)=>e.some((e=>t instanceof e));let Gt,Ht;const $t=new WeakMap,Qt=new WeakMap,Kt=new WeakMap;let Xt={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return $t.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Zt(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function Yt(t){Xt=t(Xt)}function Jt(t){return"function"==typeof t?function(t){return(Ht||(Ht=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(te(this),e),Zt(this.request)}:function(...e){return Zt(t.apply(te(this),e))}}(t):(t instanceof IDBTransaction&&function(t){if($t.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),i()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)}));$t.set(t,e)}(t),jt(t,Gt||(Gt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,Xt):t)}function Zt(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(Zt(t.result)),i()},r=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",r)}));return Kt.set(e,t),e}(t);if(Qt.has(t))return Qt.get(t);const e=Jt(t);return e!==t&&(Qt.set(t,e),Kt.set(e,t)),e}const te=t=>Kt.get(t);function ee(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=Zt(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(Zt(o.result),t.oldVersion,t.newVersion,Zt(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{r&&t.addEventListener("close",(()=>r())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}const ne=["get","getKey","getAll","getAllKeys","count"],ie=["put","add","delete","clear"],se=new Map;function re(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(se.get(e))return se.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=ie.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!ne.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&r.done]))[0]};return se.set(e,r),r}Yt((t=>({...t,get:(e,n,i)=>re(e,n)||t.get(e,n,i),has:(e,n)=>!!re(e,n)||t.has(e,n)})));const oe=["continue","continuePrimaryKey","advance"],ae={},he=new WeakMap,le=new WeakMap,ue={get(t,e){if(!oe.includes(e))return t[e];let n=ae[e];return n||(n=ae[e]=function(...t){he.set(this,le.get(this)[e](...t))}),n}};async function*ce(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;const n=new Proxy(e,ue);for(le.set(n,e),Kt.set(n,te(e));e;)yield n,e=await(he.get(n)||e.continue()),he.delete(n)}function fe(t,e){return e===Symbol.asyncIterator&&jt(t,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===e&&jt(t,[IDBIndex,IDBObjectStore])}Yt((t=>({...t,get:(e,n,i)=>fe(e,n)?ce:t.get(e,n,i),has:(e,n)=>fe(e,n)||t.has(e,n)})));class de{constructor(){this.db=null}static getInstance(){return de.instance||(de.instance=new de),de.instance}async _openMetaDB(){return this.db||(this.db=await ee("###meta",1,{upgrade(t){const e=t.createObjectStore("meta",{keyPath:"fileName",autoIncrement:!1});e.createIndex("length","length"),e.createIndex("type","type"),e.createIndex("chunkSize","chunkSize")}})),this.db}async exists(t){if(!t)throw new Error("fileName is required to check metadata existence");const e=(await this._openMetaDB()).transaction("meta","readonly"),n=e.objectStore("meta"),i=await n.getKey(t);return await e.done,null!=i}async get(t){const e=(await this._openMetaDB()).transaction("meta","readonly"),n=e.objectStore("meta");if(!t)throw new Error("fileName is required for retrieving metadata");const i=await n.get(t);return await e.done,i}async set(t){if(!t||!t.fileName)throw new Error("fileName is required in the metadata");const e=(await this._openMetaDB()).transaction("meta","readwrite"),n=e.objectStore("meta");await n.put(t),await e.done}async del(t){const e=(await this._openMetaDB()).transaction("meta","readwrite"),n=e.objectStore("meta");if(!t)throw new Error("fileName is required for deleting metadata");await n.delete(t),await e.done}}const ge=de.getInstance();var pe={exports:{}};function ye(t,e,n){if("function"==typeof t&&(n=e,e=t,t=null),!(n>=1))throw new Error("fastqueue concurrency must be equal to or greater than 1");var i=function(t){var e=new t,n=e;return{get:function(){var i=e;return i.next?e=i.next:(e=new t,n=e),i.next=null,i},release:function(t){n.next=t,n=t}}}(we),s=null,r=null,o=0,a=null,h={push:function(u,c){var f=i.get();f.context=t,f.release=l,f.value=u,f.callback=c||be,f.errorHandler=a,o>=n||h.paused?r?(r.next=f,r=f):(s=f,r=f,h.saturated()):(o++,e.call(t,f.value,f.worked))},drain:be,saturated:be,pause:function(){h.paused=!0},paused:!1,get concurrency(){return n},set concurrency(t){if(!(t>=1))throw new Error("fastqueue concurrency must be equal to or greater than 1");if(n=t,!h.paused)for(;s&&o<n;)o++,l()},running:function(){return o},resume:function(){if(h.paused)for(h.paused=!1;s&&o<n;)o++,l()},idle:function(){return 0===o&&0===h.length()},length:function(){for(var t=s,e=0;t;)t=t.next,e++;return e},getQueue:function(){for(var t=s,e=[];t;)e.push(t.value),t=t.next;return e},unshift:function(u,c){var f=i.get();f.context=t,f.release=l,f.value=u,f.callback=c||be,f.errorHandler=a,o>=n||h.paused?s?(f.next=s,s=f):(s=f,r=f,h.saturated()):(o++,e.call(t,f.value,f.worked))},empty:be,kill:function(){s=null,r=null,h.drain=be},killAndDrain:function(){s=null,r=null,h.drain(),h.drain=be},error:function(t){a=t}};return h;function l(a){a&&i.release(a);var l=s;l&&o<=n?h.paused?o--:(r===s&&(r=null),s=l.next,l.next=null,e.call(t,l.value,l.worked),null===r&&h.empty()):0==--o&&h.drain()}}function be(){}function we(){this.value=null,this.callback=be,this.next=null,this.release=be,this.context=null,this.errorHandler=null;var t=this;this.worked=function(e,n){var i=t.callback,s=t.errorHandler,r=t.value;t.value=null,t.callback=be,t.errorHandler&&s(e,r),i.call(t.context,e,n),t.release(t)}}pe.exports=ye;var me=pe.exports.promise=function(t,e,n){"function"==typeof t&&(n=e,e=t,t=null);var i=ye(t,(function(t,n){e.call(this,t).then((function(t){n(null,t)}),n)}),n),s=i.push,r=i.unshift;return i.push=function(t){var e=new Promise((function(e,n){s(t,(function(t,i){t?n(t):e(i)}))}));return e.catch(be),e},i.unshift=function(t){var e=new Promise((function(e,n){r(t,(function(t,i){t?n(t):e(i)}))}));return e.catch(be),e},i.drained=function(){if(i.idle())return new Promise((function(t){t()}));var t=i.drain;return new Promise((function(e){i.drain=function(){t(),e()}}))},i};class _e{constructor(){this.queue=null,this.awaitPause=Promise.resolve(),this._initQueue()}waitUntilQueueEmpty(){return this.queue.idle()?Promise.resolve():this.queue.drained()}_initQueue(){this.queue||(this.queue=me((async t=>{try{return await t.execute()}catch(e){t.callback&&t.callback(e)}}),1))}addTask(t){return new Promise(((e,n)=>{if(this.queue.paused&&this.resumeQueue(),this.queueCleared)return e();this.queue.push({execute:t,callback:(t,i)=>{t?n(t):e(i)}})}))}clearQueue(){this.queueCleared=!0,this.queue.kill(),this._initQueue()}pauseQueue(){this.queue.pause(),this.awaitPause=new Promise((t=>{this._resume=t}))}resumeQueue(){this.queue.resume()}get isPaused(){return this.queue.paused}}var ve={exports:{}};function Le(){}Le.prototype={on:function(t,e,n){var i=this.e||(this.e={});return(i[t]||(i[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var i=this;function s(){i.off(t,s),e.apply(n,arguments)}return s._=e,this.on(t,s,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),i=0,s=n.length;i<s;i++)n[i].fn.apply(n[i].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),i=n[t],s=[];if(i&&e)for(var r=0,o=i.length;r<o;r++)i[r].fn!==e&&i[r].fn._!==e&&s.push(i[r]);return s.length?n[t]=s:delete n[t],this}},ve.exports=Le,ve.exports.TinyEmitter=Le;var Se=xt(ve.exports);class ke extends Se{constructor(t,e={}){super(),this.suspended=!1,this.opened=!1,this.closed=!0,this.meta={chunkSize:4096,...e,fileName:t,length:0},this.queue=new _e,this.metaManager=ge,this._initializeDB()}async _initializeDB(){if(!this.db||!this.opened||this.closed)try{this.db=await async function(t,e={}){const{openBlockingHandler:n=(t,e,n)=>{n.target.close()},openBlockedHandler:i=t=>{t.target.close()}}=e;return await ee(t,void 0,{upgrade(t){t.createObjectStore("chunks",{keyPath:"chunk",autoIncrement:!1}).createIndex("data","data")},blocking(t,e,i){n?.(t,e,i)},blocked(...t){i?.(...t)}})}(this.fileName,{chunkSize:this.chunkSize});const t=await this.metaManager.get(this.fileName);this.meta=t||{fileName:this.fileName,chunkSize:this.chunkSize,length:0},this.opened=!0,this.closed=!1}catch(t){}}async ready(){this.opened||await this._initializeDB()}async ensureDBReady(){this.closing||this.purging||(this.opened&&!this.closed||await this._initializeDB(),this.db||await this._initializeDB(),this.meta&&!isNaN(this.meta.length)||(this.meta={fileName:this.fileName,chunkSize:this.chunkSize,length:0}))}get fileName(){return this.meta?this.meta.fileName:null}get chunkSize(){return this.meta.chunkSize}get length(){return this?.meta?.length||0}get size(){return this?.meta?.length||0}get paused(){return this.queue.isPaused}open(t=()=>{}){this.ready().then((async e=>{this.db=e;const n=await ge.get(this.fileName);this.meta=n||{fileName:this.fileName,chunkSize:this.chunkSize,length:0},this.opened=!0,this.closed=!1,t(null)})).catch((e=>t(e)))}write(t,e,n=()=>{}){this.queue.addTask((async()=>{await this.ensureDBReady(),this.meta||(this.meta={fileName:this.fileName,chunkSize:this.chunkSize,length:0});const i=this._blocks(t,t+e.length),s=this.db.transaction("chunks","readwrite"),r=s.objectStore("chunks");let o=0;for(const{block:t,start:n,end:s}of i){const i=await r.get(t)||{data:Vt.alloc(this.chunkSize)},a=s-n;Vt.copy(Vt.from(e),i.data,n,o,o+a),await r.put({chunk:t,data:i.data}),o+=a}await s.done;const a=Math.max(this.meta.length,t+e.length);this.meta.length=a,await this.metaManager.set(this.meta),n(null)})).catch(n)}read(t,e,n=()=>{}){this.queue.addTask((async()=>{await this.ensureDBReady();const i=this.meta.length;if(0===i||!this.meta)return n(null,Vt.alloc(e||0));if(t+e>i)return n(new xe(`Could not satisfy length. offset + size (${t+e}) is greater than the file length (${i})`,"EINVAL"));const s=this._blocks(t,t+e),r=this.db.transaction("chunks","readonly"),o=r.objectStore("chunks"),a=[];for(const{block:t,start:e,end:n}of s){const i=await o.get(t);i&&i.data?a.push(i.data.slice(e,n)):a.push(Vt.alloc(n-e,0))}await r.done;const h=a.length?Vt.concat(a):Vt.alloc(0);n(null,h)})).catch(n)}del(t,e,n=()=>{}){this.queue.addTask((async()=>{await this.ensureDBReady();const i=await this.metaManager.get(this.fileName);if(this.meta=i||{fileName:this.fileName,chunkSize:this.chunkSize,length:0},e===1/0&&(e=this.meta.length-t),t>=this.meta.length||e<=0)return n(new Error("Invalid range for deletion"));const s=t+e;if(s>=this.meta.length)return this.truncate(t,n);const r=this._blocks(t,s),o=this.db.transaction("chunks","readwrite"),a=o.objectStore("chunks"),[{block:h,start:l,end:u}]=r,c=await a.get(h);if(c&&c.data){const t=c.data.slice(0,l),e=Vt.alloc(u-l,0),n=c.data.slice(u),i=Vt.concat([t,e,n]);await a.put({chunk:h,data:i})}for(const{block:t}of r.slice(1))await a.put({chunk:t,data:Vt.alloc(this.chunkSize)});await o.done;const f=Math.max(this.meta.length,t+e);this.meta.length=f,await this.metaManager.set(this.meta),n(null)})).catch(n)}close(t=()=>{}){if(this.closed)return console.warn("File is already closed."),void t(null);this.queue.waitUntilQueueEmpty().then((async()=>{try{this.db=null,this.queue={},this.closed=!0,console.log("File closed successfully"),t(null)}catch(e){console.error("Error during close:",e.message),t(e)}})).catch(t)}truncate(t,e=()=>{}){this.queue.addTask((async()=>{await this.ensureDBReady();const n=this.meta.length;if(t>n)return this.write(n,Vt.alloc(t-n),e);const i=this._blocks(t,n),s=this.db.transaction("chunks","readwrite"),r=s.objectStore("chunks");for(const{block:t}of i.slice(1))await r.delete(t);const[{block:o,start:a}]=i,h=await r.get(o);if(h&&h.data){const t=Vt.alloc(h.data.length);Vt.copy(h.data,t,0,0,a),await r.put({chunk:o,data:t})}await s.done,this.meta.length=t,await this.metaManager.set(this.meta),e(null)})).catch(e)}stat(t=()=>{}){this.queue.addTask((async()=>{let e;await this.ensureDBReady();const n=await this.metaManager.get(this.fileName);if(!n||isNaN(n.length)){e=new xe(`File (${this.fileName}) does not exist`,"ENOENT");const n={length:0,fileName:this.fileName};return t(e,n)}n.length=isNaN(n.length)?0:n.length;const i={length:n.length,size:n.length,chunkSize:n.chunkSize||void 0,fileName:n.fileName};t(null,i)})).catch(t)}suspend(t=()=>{}){this.queue.pauseQueue(),setTimeout((()=>{this.emit("suspend"),t()}),0)}async _verifyDatabaseExists(){return"databases"in indexedDB?(await indexedDB.databases()).some((t=>t.name===this.fileName)):(console.warn("IndexedDB.databases() is not supported in this browser"),!0)}purge(t=()=>{}){this.closed?(console.log("File already closed, purging directly"),this._performPurge(t)):this.queue.waitUntilQueueEmpty().then((()=>this._performPurge(t))).catch(t)}async _performPurge(t=()=>{}){try{await this._verifyDatabaseExists()&&(await function(t,{blocked:e}={}){const n=indexedDB.deleteDatabase(t);return e&&n.addEventListener("blocked",(t=>e(t.oldVersion,t))),Zt(n).then((()=>{}))}(this.fileName),await this._verifyDatabaseExists()),await this.metaManager.del(this.fileName),this.db=null,this.meta={fileName:this.fileName,chunkSize:this.chunkSize,length:0},Ee.delete(this.fileName),t(null)}catch(e){console.error(`Error during purge: ${e.message}`),t(e)}}unlink(t=()=>{}){this.purge(t)}_blocks(t,e){return function(t,e,n){const i=[];for(let s=Math.floor(e/t)*t;s<n;s+=t)i.push({block:Math.floor(s/t),start:Math.max(s,e)%t,end:Math.min(s+t,n)%t||t});return i}(this.chunkSize,t,e)}}const Ee=new Map;class xe extends Error{constructor(t,e){super(t),this.code=e}}class ze extends Et{constructor(t,e={}){const{layeredConfig:n,...i}=e;super(function(t,e={}){const{chunkSize:n=4096,directory:i=""}=e;if(i&&(t=`${i}/${t}`),Ee.has(t)){const e=Ee.get(t);if(!e.closed)return e;Ee.delete(t)}const s=new ke(t,{chunkSize:n});return Ee.set(t,s),s}(t,i),n)}}export{ze as RandomAccessIdbWithOverlay,ze as default};
